{"version":3,"file":"826.js?_cache=6564b74ba9a88748417c","mappings":"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","sources":["webpack://grafana-lokiexplore-app/./Components/AppConfig/AppConfig.tsx"],"sourcesContent":["import React, { ChangeEvent, useState } from 'react';\n\nimport { css } from '@emotion/css';\nimport { isNumber } from 'lodash';\nimport { lastValueFrom } from 'rxjs';\n\nimport {\n  AppPluginMeta,\n  DataSourceInstanceSettings,\n  GrafanaTheme2,\n  PluginConfigPageProps,\n  PluginMeta,\n  rangeUtil,\n} from '@grafana/data';\nimport { DataSourcePicker, getBackendSrv, locationService } from '@grafana/runtime';\nimport { Button, Field, FieldSet, Input, useStyles2 } from '@grafana/ui';\n\nimport { logger } from '../../services/logger';\nimport { getDefaultDatasourceFromDatasourceSrv, getLastUsedDataSourceFromStorage } from '../../services/store';\n\nexport type JsonData = {\n  dataSource?: string;\n  interval?: string;\n};\n\ntype State = {\n  dataSource: string;\n  interval: string;\n  isValid: boolean;\n};\n\n// 1 hour minimum\nconst MIN_INTERVAL_SECONDS = 3600;\n\ninterface Props extends PluginConfigPageProps<AppPluginMeta<JsonData>> {}\n\nconst AppConfig = ({ plugin }: Props) => {\n  const styles = useStyles2(getStyles);\n  const { enabled, jsonData, pinned } = plugin.meta;\n\n  const [state, setState] = useState<State>({\n    dataSource:\n      jsonData?.dataSource ?? getDefaultDatasourceFromDatasourceSrv() ?? getLastUsedDataSourceFromStorage() ?? '',\n    interval: jsonData?.interval ?? '',\n    isValid: isValid(jsonData?.interval ?? ''),\n  });\n\n  const onChangeDatasource = (ds: DataSourceInstanceSettings) => {\n    setState({\n      ...state,\n      dataSource: ds.uid,\n    });\n  };\n\n  const onChangeInterval = (event: ChangeEvent<HTMLInputElement>) => {\n    const interval = event.target.value.trim();\n    setState({\n      ...state,\n      interval,\n      isValid: isValid(interval),\n    });\n  };\n\n  return (\n    <div data-testid={testIds.appConfig.container}>\n      <FieldSet label=\"Settings\">\n        <Field\n          description={\n            <span>\n              The default data source to be used for new Logs Drilldown users. Each user can override their default by\n              setting another data source in Logs Drilldown.\n            </span>\n          }\n          label={'Default data source'}\n        >\n          <DataSourcePicker\n            width={60}\n            filter={(ds) => ds.type === 'loki'}\n            current={state.dataSource}\n            onChange={onChangeDatasource}\n          />\n        </Field>\n\n        <Field\n          invalid={!isValid(state.interval)}\n          error={'Interval is invalid. Please enter an interval longer then \"60m\". For example: 3d, 1w, 1m'}\n          description={\n            <span>\n              The maximum interval that can be selected in the time picker within the Grafana Logs Drilldown app. If\n              empty, users can select any time range interval in Grafana Logs Drilldown. <br />\n              Example values: 7d, 24h, 2w\n            </span>\n          }\n          label={'Maximum time picker interval'}\n          className={styles.marginTop}\n        >\n          <Input\n            width={60}\n            id=\"interval\"\n            data-testid={testIds.appConfig.interval}\n            label={`Max interval`}\n            value={state?.interval}\n            placeholder={`7d`}\n            onChange={onChangeInterval}\n          />\n        </Field>\n\n        <div className={styles.marginTop}>\n          <Button\n            type=\"submit\"\n            data-testid={testIds.appConfig.submit}\n            onClick={() =>\n              updatePluginAndReload(plugin.meta.id, {\n                enabled,\n                jsonData: {\n                  dataSource: state.dataSource,\n                  interval: state.interval,\n                },\n                pinned,\n              })\n            }\n            disabled={!isValid(state.interval)}\n          >\n            Save settings\n          </Button>\n        </div>\n      </FieldSet>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  colorWeak: css`\n    color: ${theme.colors.text.secondary};\n  `,\n  icon: css({\n    marginLeft: theme.spacing(1),\n  }),\n  label: css({\n    alignItems: 'center',\n    display: 'flex',\n    marginBottom: theme.spacing(0.75),\n  }),\n  marginTop: css`\n    margin-top: ${theme.spacing(3)};\n  `,\n  marginTopXl: css`\n    margin-top: ${theme.spacing(6)};\n  `,\n});\n\nconst updatePluginAndReload = async (pluginId: string, data: Partial<PluginMeta<JsonData>>) => {\n  try {\n    await updatePlugin(pluginId, data);\n\n    // Reloading the page as the changes made here wouldn't be propagated to the actual plugin otherwise.\n    // This is not ideal, however unfortunately currently there is no supported way for updating the plugin state.\n    locationService.reload();\n  } catch (e) {\n    logger.error(e, { msg: 'Error while updating the plugin' });\n  }\n};\n\nconst testIds = {\n  appConfig: {\n    container: 'data-testid ac-container',\n    datasource: 'data-testid ac-datasource-input',\n    interval: 'data-testid ac-interval-input',\n    submit: 'data-testid ac-submit-form',\n  },\n};\n\nexport const updatePlugin = async (pluginId: string, data: Partial<PluginMeta>) => {\n  const response = getBackendSrv().fetch({\n    data,\n    method: 'POST',\n    url: `/api/plugins/${pluginId}/settings`,\n  });\n\n  const dataResponse = await lastValueFrom(response);\n\n  return dataResponse.data;\n};\n\nconst isValid = (interval: string): boolean => {\n  try {\n    if (interval) {\n      const seconds = rangeUtil.intervalToSeconds(interval);\n      return isNumber(seconds) && seconds >= MIN_INTERVAL_SECONDS;\n    } else {\n      // Empty strings are fine\n      return true;\n    }\n  } catch (e) {}\n\n  return false;\n};\n\nexport default AppConfig;\n"],"names":["getStyles","theme","colorWeak","css","colors","text","secondary","icon","marginLeft","spacing","label","alignItems","display","marginBottom","marginTop","marginTopXl","updatePluginAndReload","pluginId","data","updatePlugin","locationService","reload","e","logger","error","msg","testIds","appConfig","container","datasource","interval","submit","response","getBackendSrv","fetch","method","url","lastValueFrom","isValid","seconds","rangeUtil","intervalToSeconds","isNumber","plugin","styles","useStyles2","enabled","jsonData","pinned","meta","state","setState","useState","dataSource","getLastUsedDataSourceFromStorage","getDefaultDatasourceFromDatasourceSrv","div","data-testid","FieldSet","Field","description","span","DataSourcePicker","width","filter","ds","type","current","onChange","uid","invalid","br","className","Input","id","value","placeholder","event","target","trim","Button","onClick","disabled"],"sourceRoot":""}